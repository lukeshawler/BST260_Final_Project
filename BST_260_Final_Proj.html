<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Labor Productivity vs.&nbsp;Real Minimum Wages: A Multinational Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="BST_260_Final_Proj_files/libs/clipboard/clipboard.min.js"></script>
<script src="BST_260_Final_Proj_files/libs/quarto-html/quarto.js"></script>
<script src="BST_260_Final_Proj_files/libs/quarto-html/popper.min.js"></script>
<script src="BST_260_Final_Proj_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BST_260_Final_Proj_files/libs/quarto-html/anchor.min.js"></script>
<link href="BST_260_Final_Proj_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BST_260_Final_Proj_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BST_260_Final_Proj_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BST_260_Final_Proj_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BST_260_Final_Proj_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Labor Productivity vs.&nbsp;Real Minimum Wages: A Multinational Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction-motivation" class="level2">
<h2 class="anchored" data-anchor-id="introduction-motivation">Introduction &amp; Motivation</h2>
<p>There has been much discussion in recent years about income inequality in the United States. Americans have witnessed the continued rise of CEO wages at the expense of wage increases for ordinary workers. An integral component underpinning this discussion is the relationship between worker productivity and worker income. In 2021, the Economic Policy Institute published a report detailing how worker productivity has grown at 3.5 times the rate of pay for Americans since 1979<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. In this article, author Lawrence Mishel surmises that this divergence between worker productivity and compensation indicates that a concerted effort has been “engineered by those with the most wealth and power.” Documented by Mishel and Bivens in 2021<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, suppression of wages in the United States was generated by policy choices that have resulted in declining unionization rates, excess unemployment, corporate globalization, and lower minimum wages.</p>
<p>While this phenomenon is a known fact in the US, is it also occurring in other developed nations? In this analysis, we will attempt to answer this question by visualizing the relationship between real minimum wages and hourly labor productivity over time in the US and other developed nations. Analyses will be conducted using data from the Banque de France<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> and the Organization for Economic Co-operation and Development (OECD) <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="epi.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Motivating figure from an Economic Policy Institute report published September 2, 2021</figcaption>
</figure>
</div>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<p>Analyses were conducted using data from the Banque de France and the OECD. The Banque de France dataset includes yearly data on labor productivity, total factor productivity, capital intensity, gross domestic product (GDP) per capita, and the average age of equipment capital stock for 23 developed nations. The data containing real minimum wages at constant prices comes from the OECD. This dataset includes minimum wage information beginning as early as 1960 from nations that are OECD members.</p>
<p>This data was downloaded from their respective sources and read into R as Excel files, in the case of the Banque de France dataset, and CSV files in the case of the OECD dataset.</p>
<p>The main analysis of this report centered around tracking real minimum wages relative to worker productivity since 1960. From the Consumer Price Index (CPI) inflation index, converting 2021 USD purchasing power parity (PPP) units to 2010 USD PPP units can be done with a factor of about 0.8284. This was done to convert real hourly minimum wages from 2021 PPP to 2010 PPP for ease of comparison to labor productivity, which is already measured in 2010 PPP per hour worked. According to the OECD<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, purchasing power parity units “are the rates of currency conversion that equalize the purchasing power of different currencies by eliminating the differences in price levels between countries. In their simplest form, PPPs are simply price relatives that show the ratio of the prices in national currencies of the same good or service in different countries. PPPs are also calculated for product groups and for each of the various levels of aggregation up to and including GDP.” Both the labor productivity data from the Banque de France and the real minimum wage data from the OECD were then pivoted into a long format, with columns denoting nation, year, and the corresponding labor productivity and real minimum wage values. These two data frames were then joined via the <code>inner_join</code> R function, keeping only the labor productivity observations that have a corresponding real minimum wage observation. After joining the data in this way, 16 nations remained for the analysis of minimum wage relative to worker productivity from 1960 to 2022.</p>
<ul>
<li>These nations include: <br>
<ul>
<li>Australia (AUS) <br></li>
<li>Belgium (BEL) <br></li>
<li>Canada (CAN) <br></li>
<li>Chile (CHE) <br></li>
<li>Germany (DEU) <br></li>
<li>Spain (ESP) <br></li>
<li>France (FRA) <br></li>
<li>Great Britain (GBR) <br></li>
<li>Greece (GRC) <br></li>
<li>Ireland (IRL) <br></li>
<li>Japan (JPN) <br></li>
<li>Mexico (MEX) <br></li>
<li>Netherlands (NLD) <br></li>
<li>New Zealand (NZL) <br></li>
<li>Portugal (PRT) <br></li>
<li>United States of America (USA) <br></li>
</ul></li>
</ul>
<p>Data visualizations were then made for each nation, with trend lines for both hourly labor productivity (2010 USD PPP) and real hourly minimum wages (2010 USD PPP).</p>
<p>An additional visualization employs a line plot of the ratio of hourly real minimum wage to hourly labor productivity for each of the 16 nations.</p>
<p>Another visualization is an animated GIF which is a scatterplot that plots minimum wage against hourly labor productivity for each of the 16 nations from 1960-2022. The visualization also features a least squares regression line to denote the linear relationship between hourly productivity and minimum wage.</p>
<p>Taking the final frame from the GIF, we also visualize this trend for just the year 2022 to better understand how the nations compare in the most recent year for which there’s data.</p>
<p>All plots were made with the <code>ggplot</code> R package.</p>
<p>A table was also made to highlight the real minimum wage to hourly labor productivity ratio for each country in the year 2022.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="figure-1" class="level3">
<h3 class="anchored" data-anchor-id="figure-1">Figure 1</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="BST_260_Final_Proj_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot, which is faceted by country, plots the trend line for labor productivity (measured in USD 2010 PPP) along with the trend line for real minimum wage (also measured in USD 2010 PPP via conversion from USD 2021 PPP). From this plot, one can see how in certain countries, such as New Zealand and Great Britain, the slopes for productivity and minimum wage appear similar. However, in other nations such as in Belgium and the USA, worker productivity has increased over time while the minimum wage has stagnated.</p>
</section>
<section id="figure-2" class="level3">
<h3 class="anchored" data-anchor-id="figure-2">Figure 2</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="BST_260_Final_Proj_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Overall, this graph is especially helpful in elucidating whether other nations are, as in the USA, seeing a similar decline in the hourly wages of a minimum wage worker relative to productivity. Further, by comparing hourly worker productivity to real minimum wages in particular (this data also happens to be more readily available compared to median hourly wages or hourly wages of a “typical worker” in various countries), we are able to analyze a policy choice (lower labor standards) that Mishel and Bivens have shown to contribute to wage suppression. A particular example of lower labor standards that they outline is lower minimum wage. Michel and Bivens assert that this is a key policy choice in the USA that has driven down the wages of the “typical worker” to the benefit of large firms.</p>
<p>By comparing the ratio of hourly real minimum wage to hourly labor productivity, changes between the two measures become even more apparent than in Figure 1 above. One may observe a clear and drastic downwards trend in this ratio between 1960 and 2022 in countries such as the Netherlands, Greece, and the USA. Similar trends are also observed in countries who began reporting data in later years, such as in Australia, Belgium, and Ireland.</p>
<p>This graph also reveals nations where the ratio between real hourly minimum wage and hourly labor productivity has actually consistently grown. Such a trend has been observed in New Zealand and Great Britain since about 2000.</p>
</section>
<section id="figure-3" class="level3">
<h3 class="anchored" data-anchor-id="figure-3">Figure 3</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="BST_260_Final_Proj_files/figure-html/unnamed-chunk-9-1.gif" class="img-fluid"></p>
</div>
</div>
<p>This animation takes a cross section of the data at each year and fits a least squares regression line with hourly labor productivity as the predictor and minimum wage as the response variable. The animation begins with the first year for which there is any data, which is 1960, and adds more countries as they begin to report their wage and productivity data. Generally, one can notice a flattening of the curve over time, indicating that over the years, minimum wage has not risen as rapidly with productivity as it once did. Watching particular countries during each playthrough of the animation helps one realize trends over time for particular countries. For example, up until the early 2000s, the USA was very close to the trendline and at one point in time led all of the selected nations in real minimum wage. Beginning in the early 2000’s the US has fallen well below the trendline, having a low real minimum wage in spite of its high hourly productivity. Other nations, such as Mexico and Chile enter the picture in the late 1980s and show little movement up until 2022. Both of these nations have maintained low hourly productivity and a low minimum wages up until the present.</p>
<p>Another interesting nation to watch is Belgium, which, as we saw in Figure 2, has had a declining minimum wage to productivity ratio over time. This is shown in Figure 3, as we see the nation enter the picture in the 70s, quickly surpassing a real minimum wage of $10 (2010 PPP). Over time, the real minimum wage has stagnated, while the hourly labor productivity has continued to increase. So, this figure helps us better understand the mechanism through which the ratios have fallen in various nations. In the USA, the decline in minimum wage to hourly productivity ratio is due to a combination of increasing labor productivity and a decreasing real minimum wage in recent years. At one point the USA had a minimum wage of over $10 (2010 PPP), in 2022 it was $6.01 (2010 PPP).</p>
</section>
<section id="figure-4" class="level3">
<h3 class="anchored" data-anchor-id="figure-4">Figure 4</h3>
<div class="cell">
<div class="cell-output-display">
<p><img src="BST_260_Final_Proj_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Taking a cross section of the most recent year’s (2022) data, we plot each of the 16 nations’ real minimum wage against its hourly productivity in 2010 USD PPP. From the graph, we see that despite having the second highest productivity of the 16 nations in 2022, the USA comes in 13th in terms of real hourly minimum wage. This graph also reveals that the USA has a lower real minimum wage than Portugal, a nation with just over half as much hourly productivity as the USA. Further, Ireland shows itself to be a significant outlier, with extremely high hourly productivity, but lower real minimum wages compared to other European nations such as Great Britain and the Netherlands.</p>
</section>
<section id="table-1" class="level3">
<h3 class="anchored" data-anchor-id="table-1">Table 1</h3>
<table class="table-striped table-hover table">
<caption>Real Minimum Wage to Productivity Ratio (2022)</caption>
<thead>
<tr class="header">
<th>Country</th>
<th>Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>New Zealand</td>
<td>0.247</td>
</tr>
<tr class="even">
<td>Australia</td>
<td>0.196</td>
</tr>
<tr class="odd">
<td>Spain</td>
<td>0.178</td>
</tr>
<tr class="even">
<td>France</td>
<td>0.174</td>
</tr>
<tr class="odd">
<td>Great Britain</td>
<td>0.166</td>
</tr>
<tr class="even">
<td>Canada</td>
<td>0.165</td>
</tr>
<tr class="odd">
<td>Germany</td>
<td>0.161</td>
</tr>
<tr class="even">
<td>Greece</td>
<td>0.159</td>
</tr>
<tr class="odd">
<td>Belgium</td>
<td>0.152</td>
</tr>
<tr class="even">
<td>Portugal</td>
<td>0.148</td>
</tr>
<tr class="odd">
<td>Netherlands</td>
<td>0.143</td>
</tr>
<tr class="even">
<td>Japan</td>
<td>0.141</td>
</tr>
<tr class="odd">
<td>Chile</td>
<td>0.108</td>
</tr>
<tr class="even">
<td>United States</td>
<td>0.081</td>
</tr>
<tr class="odd">
<td>Mexico</td>
<td>0.079</td>
</tr>
<tr class="even">
<td>Ireland</td>
<td>0.060</td>
</tr>
</tbody>
</table>
<p>Nations such as the Australia, Belgium, and the Netherlands, which have seen a decline in the ratio of real hourly minimum wage to hourly labor productivity in recent years, all still possess better ratios than Japan, Chile, the United States, Mexico, and Ireland, which make up the bottom 5.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>We have now answered the question of whether a trend that we are seeing in the USA, a decline in wages relative to productivity, holds true in other nations. We’ve definitively determined that, with respect to the minimum wage, this trend is occurring in other developed nations. We have observed a continual decrease in the real minimum wage to hourly labor productivity ratio in not only the USA, but also in Australia, Belgium, Greece, Ireland, and the Netherlands. Nations such as Canada, France, Japan, New Zealand, and Portugal all have more nuanced trendlines, but still have a smaller real minimum wage to hourly labor productivity ratio than they did when data was first collected for these nations. In fact, of the 16 nations studied, 12 nations have a smaller real minimum wage to hourly labor productivity than they did when data was first collected.</p>
<p>Due to certain characteristics of the data, (such as its independent outcomes and longitudinal nature) as well as the realities of world economics (such as the strong interconnected relationships that the economies of nations have with one another), it was difficult to fit a model on this data. Future analysis should employ longitudinal methods to try to better understand the ongoing trend of declining wages relative to productivity that we’ve seen not only in the US, but in other developed nations. Future analysis should also attempt to include more nations, though such data has proven difficult to procure for non-OECD nations. Additionally, by employing longitudinal methods in future research, other important covariates mentioned by Mishel and Bivens, such as unionization rates and the presence of non-compete clauses in worker contracts, could potentially be accounted for in order to enhance our understanding of the relationship between labor productivity and wages.</p>
</section>
<section id="appendix-all-code-for-this-report" class="level2">
<h2 class="anchored" data-anchor-id="appendix-all-code-for-this-report">Appendix: All code for this report</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="st">"BCLDatabase_online_v2.6.xlsx"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Using readxl</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(file_path)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read each sheet into a list of data frames</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sheet_names, <span class="cf">function</span>(sheet) {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(file_path, <span class="at">sheet =</span> sheet)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># remove 25th column which is simply empty</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>GDP_per_cap <span class="ot">&lt;-</span> tables[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">25</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>labor_prod <span class="ot">&lt;-</span> tables[[<span class="dv">3</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">26</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> Year)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>avg_equip_age <span class="ot">&lt;-</span> tables[[<span class="dv">5</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">25</span>))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>capital_intensity <span class="ot">&lt;-</span> tables[[<span class="dv">6</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">25</span>))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>min_wages_raw <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"minimum_wages.csv"</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#  multiply by factor of about 0.8284. This was done to convert real hourly minimum wages from 2021 PPP to 2010 PPP for ease of comparison to labor productivity, which is already measured in 2010 PPP per hour worked</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>min_wages <span class="ot">&lt;-</span> min_wages_raw <span class="sc">%&gt;%</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(REF_AREA, TIME_PERIOD, OBS_VALUE) <span class="sc">%&gt;%</span> </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country =</span> REF_AREA, <span class="at">year =</span> TIME_PERIOD, <span class="at">min_wage =</span> OBS_VALUE) <span class="sc">%&gt;%</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_wage =</span> min_wage<span class="sc">*</span>.<span class="dv">8284</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot labor productivity to long format</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>labor_prod_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="at">data =</span> labor_prod, <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="st">"year"</span>), <span class="at">names_to =</span> <span class="st">"country"</span>, <span class="at">values_to =</span> <span class="st">"hourly_prod"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># get labor productivity data for every year since 1960</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>labor_prod_1960 <span class="ot">&lt;-</span> labor_prod_long <span class="sc">%&gt;%</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1960</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># inner join labor productivity data with minimum wage data</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>wages_prod <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(labor_prod_1960, min_wages, <span class="fu">join_by</span>(country, year)) <span class="sc">%&gt;%</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ratio =</span> min_wage <span class="sc">/</span> hourly_prod)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>wages_prod_longer <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(wages_prod, <span class="at">cols =</span> <span class="fu">c</span>(hourly_prod, min_wage), <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, type, value) <span class="sc">%&gt;%</span> </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">fct_recode</span>(type, <span class="st">"Productivity"</span> <span class="ot">=</span> <span class="st">"hourly_prod"</span>, <span class="st">"Minimum Wage"</span> <span class="ot">=</span> <span class="st">"min_wage"</span>))</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>wages_prod_longer <span class="sc">%&gt;%</span> </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, value, <span class="at">color =</span> type)) <span class="sc">+</span> </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>country, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hourly Real Minimum Wage and Hourly Labor Productivity by Year"</span>, <span class="at">y =</span> <span class="st">"USD (2010 PPP)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">color =</span> <span class="st">"Measure"</span>) <span class="sc">+</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)) </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co"># facet the hourly real minimum wage to hourly labor productivity ratio by country </span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>wages_prod <span class="sc">%&gt;%</span> </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, ratio, <span class="at">color =</span> <span class="st">"red"</span>)) <span class="sc">+</span> </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>country, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Ratio of Hourly Real Minimum Wage to Hourly Labor Productivity"</span>, <span class="at">y =</span> <span class="st">"Ratio (2010 USD PPP)"</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the initial scatterplot with geom_smooth</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wages_prod, <span class="fu">aes</span>(<span class="at">x =</span> hourly_prod, <span class="at">y =</span> min_wage, <span class="at">label =</span> country)) <span class="sc">+</span> </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">group =</span> year)) <span class="sc">+</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>() <span class="sc">+</span> <span class="co"># Add labels</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Year: {closest_state}'</span>, </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Scatterplot of Hourly Productivity vs. Minimum Wage with Regression Line'</span>, <span class="at">x =</span> <span class="st">"Hourly Productivity (2010 USD PPP)"</span>, <span class="at">y =</span> <span class="st">"Minimum Wage (2010 USD PPP)"</span>) <span class="sc">+</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_minimal</span>()</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Use transition_states to create animation</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>animated_plot <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">transition_states</span>(year, <span class="at">transition_length =</span> <span class="dv">2</span>, <span class="at">state_length =</span> <span class="dv">2</span>, <span class="at">wrap =</span> F)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Render the animation</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(animated_plot, <span class="at">nframes =</span> <span class="dv">200</span>, <span class="at">duration =</span> <span class="dv">20</span>, <span class="at">end_pause =</span> <span class="dv">30</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> wages_prod <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">r =</span> <span class="fu">sum</span>(min_wage) <span class="sc">/</span> <span class="fu">sum</span>(hourly_prod)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(r)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>wages_prod <span class="sc">%&gt;%</span> </span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(hourly_prod, min_wage, <span class="at">label =</span> country)) <span class="sc">+</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F, <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>() <span class="sc">+</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Hourly Productivity (USD 2010 PPP)"</span> , <span class="at">y =</span> <span class="st">"Real Minimum Wage (USD 2010 PPP)"</span>, <span class="at">title =</span> <span class="st">"Hourly Productivity vs. Real Minimum Wage (2022)"</span>) <span class="sc">+</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>)),</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">10</span>)),</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">20</span>)),</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">20</span>, <span class="at">t =</span> <span class="dv">20</span>, <span class="at">b =</span> <span class="dv">20</span>, <span class="at">l =</span> <span class="dv">20</span>))</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Ratio of real hourly minimum wage to hourly labor productivity for 2022 only </span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>ratio_2022 <span class="ot">&lt;-</span> wages_prod <span class="sc">%&gt;%</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ratio)) <span class="sc">%&gt;%</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, ratio)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ratio_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://www.epi.org/blog/growing-inequalities-reflecting-growing-employer-power-have-generated-a-productivity-pay-gap-since-1979-productivity-has-grown-3-5-times-as-much-as-pay-for-the-typical-worker/<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://www.epi.org/unequalpower/publications/wage-suppression-inequality/<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>http://longtermproductivity.com/download.html<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://data-explorer.oecd.org/vis?df[ds]=dsDisseminateFinalDMZ&amp;df[id]=DSD_EARNINGS%40RMW&amp;df[ag]=OECD.ELS.SAE&amp;df[vs]=1.0&amp;pd=1960%2C&amp;dq=..USD_PPP.H…&amp;ly[rw]=REF_AREA&amp;ly[cl]=TIME_PERIOD&amp;to[TIME_PERIOD]=false&amp;vw=tb<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>https://www.oecd.org/sdd/prices-ppp/purchasingpowerparities-frequentlyaskedquestionsfaqs.htm<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>